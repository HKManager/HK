/*! HTML5_2D_Shooter 07-02-2014 */

function collisionDetection(){var a,b,c=0;for(a=0;a<game.obstacles.length;a++){for(intersection(game.player,game.obstacles[a])?touchingObstacle(game.player,game.obstacles[a]):(game.player.x>game.obstacles[a].x+game.obstacles[a].width||game.player.x+game.player.width<game.obstacles[a].x)&&c++,b=0;b<game.player.bulletPool.getPool().length;b++)intersection(game.obstacles[a],game.player.bulletPool.getPool()[b])&&(game.player.bulletPool.getPool()[b].isColliding=!0);for(b=0;b<game.enemyBulletPool.getPool().length;b++)intersection(game.obstacles[a],game.enemyBulletPool.getPool()[b])&&(game.enemyBulletPool.getPool()[b].isColliding=!0)}for(a=0;a<game.enemies.length;a++)if(game.enemies[a].alive)for(intersection(game.player,game.enemies[a])&&(game.player.alive=!1),b=0;b<game.player.bulletPool.getPool().length;b++)intersection(game.enemies[a],game.player.bulletPool.getPool()[b])&&(game.enemies[a].alive=!1,game.player.bulletPool.getPool()[b].isColliding=!0);for(a=0;a<game.enemyBulletPool.getPool().length;a++)intersection(game.player,game.enemyBulletPool.getPool()[a])&&(game.enemyBulletPool.getPool()[a].isColliding=!0,game.player.alive=!1);c===game.obstacles.length&&game.player.floorHeight!==game.player.canvasHeight&&(game.player.isTouchingTheFloor=!1,game.player.floorHeight=game.player.canvasHeight,game.player.speed.y=5)}function intersection(a,b){return!(a.x+a.width<b.x||b.x+b.width<a.x||a.y+a.height<b.y||b.y+b.height<a.y)}function touchingObstacle(a,b){(a.type===DRAWABLE_TYPES.player||a.type===DRAWABLE_TYPES.enemy)&&(a.previousPosition.y+a.height<b.y?a.type===DRAWABLE_TYPES.player&&(a.floorHeight=b.y-1,a.speed.y=0,a.isTouchingTheFloor=!0):a.previousPosition.y+a.height>=b.y&&(a.x+a.width+a.speed.x>=b.x&&a.x+a.width+a.speed.x<b.x+b.width?a.x=b.x-a.width-a.speed.x:a.x<b.x+b.width+a.speed.x&&(a.x=b.x+b.width+a.speed.x)))}function Drawable(){this.init=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d,this.previousPosition={x:this.x,y:this.y}},this.type=DRAWABLE_TYPES.drawable,this.speed=0,this.canvasWidth=0,this.canvasHeight=0,this.draw=function(){},this.move=function(){}}function Player(){this.type=DRAWABLE_TYPES.player,this.bulletPool=new BulletPool(30);var a=15,b=0,c=15,d=0;this.init=function(a,b,c,e){this.x=a,this.y=b,this.width=c,this.height=e,this.alive=!0,this.bulletPool.init(DRAWABLE_TYPES.bullet),this.facingLeft=!1,this.speed={x:3,y:5},this.isTouchingTheFloor=!1,this.floorHeight=null,this.isJumping=!1,d=0},this.draw=function(){this.context.drawImage(imgRepo.main,this.x,this.y)},this.move=function(){b++,this.previousPosition={x:this.x,y:this.y};var c=50;this.context.clearRect(this.x-c,this.y-c,this.width+2*c,this.height+2*c),this.floorHeight||(this.floorHeight=this.canvasHeight),this.y+this.height>this.floorHeight&&(this.y=this.floorHeight-this.height,this.isTouchingTheFloor=!0,this.speed.y=0),this.y<=0&&(this.speed.y=5,this.y=0),this.y+=this.speed.y,(KEY_STATUS.left||KEY_STATUS.right||KEY_STATUS.up||this.isJumping)&&(KEY_STATUS.left?(this.facingLeft=!0,this.x-=this.speed.x,this.x<=0&&(this.x=0)):KEY_STATUS.right&&(this.facingLeft=!1,this.x+=this.speed.x,this.x>=this.canvasWidth-this.width&&(this.x=this.canvasWidth-this.width)),KEY_STATUS.up&&this.isTouchingTheFloor&&(this.speed.y=-5,this.y+=this.speed.y,this.isJumping=!0,this.isTouchingTheFloor=!1)),this.isJumping&&this.jump(),this.draw(),KEY_STATUS.space&&b>=a&&(this.fire(),b=0)},this.fire=function(){var a=this.facingLeft?-5:5,b=this.facingLeft?this.x-imgRepo.mainBullet.width:this.x+this.width;this.bulletPool.shoot(b,this.y+10,a)},this.jump=function(){d=(d+1)%(c+1),d>=c&&(this.speed.y=-this.speed.y,this.isJumping=!1,d=0)}}function Enemy(){this.type=DRAWABLE_TYPES.enemy,this.init=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d,this.alive=!0,this.facingLeft=!1},this.draw=function(){return this.context.clearRect(this.x-1,this.y,this.width+1,this.height),this.alive?(this.x+=this.speed.x,this.y+=this.speed.y,this.calculateBehaviour(),this.context.drawImage(this.image(),this.x,this.y),!1):void 0},this.bulletHeight=function(){return this.y},this.fire=function(){var a=this.facingLeft?-4:4,b=this.facingLeft?this.x-imgRepo.enemyBullet.width:this.x+this.width;game.enemyBulletPool.shoot(b,this.bulletHeight(),a)},this.calculateBehaviour=function(){},this.image=function(){}}function Enemy_A(){this.limit=null,this.speed={x:1,y:0},this.bulletHeight=function(){return this.y+this.height/2},this.image=function(){return imgRepo.enemy_1},this.calculateBehaviour=function(){this.limit||(this.limit={left:this.x-35,right:this.x+35}),this.x<=this.limit.left?(this.fire(),this.facingLeft=!1,this.speed.x=-this.speed.x):this.x>=this.limit.right+this.width&&(this.fire(),this.facingLeft=!0,this.speed.x=-this.speed.x)}}function Enemy_B(){this.speed={x:0,y:1},this.limit=null,this.image=function(){return imgRepo.enemy_2},this.calculateBehaviour=function(){this.limit||(this.limit={up:this.y-this.height,down:this.y+this.height}),this.y<=this.limit.up?(this.facingLeft=!this.facingLeft,this.speed.y=-this.speed.y,this.fire()):this.y>=this.limit.down&&(this.speed.y=-this.speed.y)}}function Bullet(a){this.alive=!1,this.type=a,this.spawn=function(a,b,c){this.x=a,this.y=b,this.speed=c,this.alive=!0,this.isColliding=!1},this.draw=function(){return this.context.clearRect(this.x-1,this.y-1,this.width+2,this.height+2),this.x+=this.speed,this.isColliding?!0:this.x<0||this.x>this.canvasWidth-this.width?!0:(this.type===DRAWABLE_TYPES.bullet?this.context.drawImage(imgRepo.mainBullet,this.x,this.y):this.type===DRAWABLE_TYPES.enemyBullet&&this.context.drawImage(imgRepo.enemyBullet,this.x,this.y),!1)},this.clear=function(){this.x=0,this.y=0,this.speed=0,this.alive=!1,this.isColliding=!1}}function Obstacle(){this.type=DRAWABLE_TYPES.obstacle,this.draw=function(){this.context.drawImage(this.image(),this.x,this.y)},this.image=function(){}}function Obstacle_A(){this.image=function(){return imgRepo.obstacle_1}}function Obstacle_B(){this.image=function(){return imgRepo.obstacle_2}}function init(){game.init()&&game.start()}function Game(){this.init=function(){return this.bgCanvas=document.getElementById("bg"),this.enemiesCanvas=document.getElementById("enemies"),this.mainCanvas=document.getElementById("main"),this.obstaclesCanvas=document.getElementById("obstacles"),this.bgCanvas.getContext?(this.bgContext=this.bgCanvas.getContext("2d"),this.enemiesContext=this.enemiesCanvas.getContext("2d"),this.mainContext=this.mainCanvas.getContext("2d"),this.obstaclesContext=this.obstaclesCanvas.getContext("2d"),Player.prototype.context=this.mainContext,Player.prototype.canvasWidth=this.mainCanvas.width,Player.prototype.canvasHeight=this.mainCanvas.height,Enemy_A.prototype.context=this.enemiesContext,Enemy_A.prototype.canvasWidth=this.enemiesCanvas.width,Enemy_A.prototype.canvasHeight=this.enemiesCanvas.height,Enemy_B.prototype.context=this.enemiesContext,Enemy_B.prototype.canvasWidth=this.enemiesCanvas.width,Enemy_B.prototype.canvasHeight=this.enemiesCanvas.height,Bullet.prototype.context=this.enemiesContext,Bullet.prototype.canvasWidth=this.enemiesCanvas.width,Bullet.prototype.canvasHeight=this.enemiesCanvas.height,Obstacle_A.prototype.context=this.obstaclesContext,Obstacle_A.prototype.canvasWidth=this.obstaclesCanvas.width,Obstacle_A.prototype.canvasHeight=this.obstaclesCanvas.height,Obstacle_B.prototype.context=this.obstaclesContext,Obstacle_B.prototype.canvasWidth=this.obstaclesCanvas.width,Obstacle_B.prototype.canvasHeight=this.obstaclesCanvas.height,this.player=new Player,this.player.init(10,20,imgRepo.main.width,imgRepo.main.height),this.enemies=[],this.enemies[0]=new Enemy_A,this.enemies[0].init(150,this.enemiesCanvas.height-imgRepo.enemy_1.height,imgRepo.enemy_1.width,imgRepo.enemy_1.height),this.enemies[1]=new Enemy_A,this.enemies[1].init(this.enemiesCanvas.width-100,this.enemiesCanvas.height-imgRepo.enemy_1.height,imgRepo.enemy_1.width,imgRepo.enemy_1.height),this.enemies[2]=new Enemy_B,this.enemies[2].init(330,this.enemiesCanvas.height-10,imgRepo.enemy_2.width,imgRepo.enemy_2.height),this.enemyBulletPool=new BulletPool(40),this.enemyBulletPool.init(DRAWABLE_TYPES.enemyBullet),this.obstacles=[],this.obstacles[0]=new Obstacle_A,this.obstacles[0].init(80,this.obstaclesCanvas.height-imgRepo.obstacle_1.height,imgRepo.obstacle_1.width,imgRepo.obstacle_1.height),this.obstacles[1]=new Obstacle_A,this.obstacles[1].init(470,this.obstaclesCanvas.height-imgRepo.obstacle_1.height,imgRepo.obstacle_1.width,imgRepo.obstacle_1.height),this.obstacles[2]=new Obstacle_B,this.obstacles[2].init(280,this.obstaclesCanvas.height-imgRepo.obstacle_2.height,imgRepo.obstacle_2.width,imgRepo.obstacle_2.height),!0):!1},this.start=function(){console.log("START"),this.player.draw();for(var a=0;a<game.obstacles.length;a++)game.obstacles[a].draw();animate()},this.gameOver=function(){document.getElementById("gameOver").style.display="block"},this.win=function(){document.getElementById("gameWin").style.display="block"},this.restart=function(){document.getElementById("gameOver").style.display="none",document.getElementById("gameWin").style.display="none",this.bgContext.clearRect(0,0,this.bgCanvas.width,this.bgCanvas.height),this.enemiesContext.clearRect(0,0,this.enemiesCanvas.width,this.enemiesCanvas.height),this.mainContext.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.obstaclesContext.clearRect(0,0,this.obstaclesCanvas.width,this.obstaclesCanvas.height),this.player.init(10,this.mainCanvas.height-imgRepo.main.height-200,imgRepo.main.width,imgRepo.main.height),this.enemies[0].init(150,this.enemiesCanvas.height-imgRepo.enemy_1.height,imgRepo.enemy_1.width,imgRepo.enemy_1.height),this.enemies[1].init(this.enemiesCanvas.width-100,this.enemiesCanvas.height-imgRepo.enemy_1.height,imgRepo.enemy_1.width,imgRepo.enemy_1.height),this.enemies[2].init(330,this.enemiesCanvas.height-10,imgRepo.enemy_2.width,imgRepo.enemy_2.height),this.enemyBulletPool.init(DRAWABLE_TYPES.enemyBullet),this.obstacles[0].init(80,this.obstaclesCanvas.height-imgRepo.obstacle_1.height,imgRepo.obstacle_1.width,imgRepo.obstacle_1.height),this.obstacles[1].init(470,this.obstaclesCanvas.height-imgRepo.obstacle_1.height,imgRepo.obstacle_1.width,imgRepo.obstacle_1.height),this.obstacles[2].init(280,this.obstaclesCanvas.height-imgRepo.obstacle_2.height,imgRepo.obstacle_2.width,imgRepo.obstacle_2.height),this.start()}}function animate(){var a;if(game.player.alive){var b=0;for(a=0;a<game.enemies.length;a++)game.enemies[a].alive||b++;if(b===game.enemies.length)game.win();else{for(requestAnimFrame(animate),game.player.move(),game.player.bulletPool.animate(),a=0;a<game.enemies.length;a++)game.enemies[a].draw();game.enemyBulletPool.animate(),collisionDetection()}}else game.gameOver()}function ImgRepo(){function a(){return d++,new Image}function b(){c++,c===d&&(console.log("all images loaded"),window.init())}var c=0,d=0;this.mainBullet=a(),this.enemyBullet=a(),this.main=a(),this.enemy_1=a(),this.enemy_2=a(),this.obstacle_1=a(),this.obstacle_2=a(),this.mainBullet.onload=function(){b()},this.enemyBullet.onload=function(){b()},this.main.onload=function(){b()},this.enemy_1.onload=function(){b()},this.enemy_2.onload=function(){b()},this.obstacle_1.onload=function(){b()},this.obstacle_2.onload=function(){b()},this.mainBullet.src="./img/bullet_main.png",this.enemyBullet.src="./img/bullet_enemy.png",this.main.src="./img/main.png",this.enemy_1.src="./img/enemy_1.png",this.enemy_2.src="./img/enemy_2.png",this.obstacle_1.src="./img/obstacle_1.png",this.obstacle_2.src="./img/obstacle_2.png"}function BulletPool(a){var b=a,c=[];this.getPool=function(){for(var a=[],d=0;b>d;d++)c[d].alive&&a.push(c[d]);return a},this.init=function(a){if("bullet"===a||"enemyBullet"===a){var d,e;if("bullet"===a)for(e=0;b>e;e++)d=new Bullet("bullet"),d.init(0,0,imgRepo.mainBullet.width,imgRepo.mainBullet.height),c[e]=d;else if("enemyBullet"===a)for(e=0;b>e;e++)d=new Bullet("enemyBullet"),d.init(0,0,imgRepo.enemyBullet.width,imgRepo.enemyBullet.height),c[e]=d}},this.shoot=function(a,d,e){c[b-1].alive||(c[b-1].spawn(a,d,e),c.unshift(c.pop()))},this.animate=function(){for(var a=0;b>a&&c[a].alive;a++)c[a].draw()&&(c[a].clear(),c.push(c.splice(a,1)[0]))}}var DRAWABLE_TYPES={drawable:"drawable",obstacle:"obstacle",player:"player",enemy:"enemy",bullet:"bullet",enemyBullet:"enemyBullet"};Player.prototype=new Drawable,Enemy.prototype=new Drawable,Enemy_A.prototype=new Enemy,Enemy_B.prototype=new Enemy,Bullet.prototype=new Drawable,Obstacle.prototype=new Drawable,Obstacle_A.prototype=new Obstacle,Obstacle_B.prototype=new Obstacle;var game=new Game,imgRepo=new ImgRepo;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),KEY_CODES={32:"space",37:"left",38:"up",39:"right"},KEY_STATUS={};for(var code in KEY_CODES)KEY_STATUS[KEY_CODES[code]]=!1;document.onkeydown=function(a){var b=a.keyCode?a.keyCode:a.charCode;KEY_CODES[b]&&(a.preventDefault(),KEY_STATUS[KEY_CODES[b]]=!0)},document.onkeyup=function(a){var b=a.keyCode?a.keyCode:a.charCode;KEY_CODES[b]&&(a.preventDefault(),KEY_STATUS[KEY_CODES[b]]=!1)};
//# sourceMappingURL=app.min.map