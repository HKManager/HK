<!DOCTYPE html>
<html id="htmlMain" style="display: block;">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>Basic Form Elements | Bootstrap Based Admin Template - Material Design</title>
    <!-- Favicon-->
    <link rel="icon" href="../Content/favicon.ico" type="image/x-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet"
        type="text/css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">

    <!-- Bootstrap Core Css -->
    <link href="../Content/plugins/bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Waves Effect Css -->
    <link href="../Content/plugins/node-waves/waves.css" rel="stylesheet" />

    <!-- Animation Css -->
    <link href="../Content/plugins/animate-css/animate.css" rel="stylesheet" />

    <!-- Bootstrap Material Datetime Picker Css -->
    <link href="../Content/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css"
        rel="stylesheet" />

    <!-- Bootstrap DatePicker Css -->
    <link href="../Content/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css" rel="stylesheet" />

    <!-- Wait Me Css -->
    <link href="../Content/plugins/waitme/waitMe.css" rel="stylesheet" />

    <!-- Bootstrap Select Css -->
    <link href="../Content/plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />

    <!-- Dropzone Css -->
    <link href="../Content/plugins/dropzone/dropzone.css" rel="stylesheet">

    <!-- Custom Css -->
    <link href="../Content/css/style.css" rel="stylesheet">

    <!-- Sweetalert Css -->
    <link href="../Content/plugins/sweetalert/sweetalert.css" rel="stylesheet" />

    <!-- AdminBSB Themes. You can choose a theme from css/themes instead of get all themes -->
    <link href="../Content/css/themes/all-themes.css" rel="stylesheet" />

    <!-- 네비게이션 메뉴 관련 -->
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/earlyaccess/nanumpenscript.css">
    <link rel="stylesheet" href="../css/menu/reset.css"> <!-- CSS reset -->


    <!-- 신인환 수정 SBGrid 짤림 -->
    <!-- <link rel="stylesheet" href="../css/menu/style.css"> -->
    <!-- 신인환 수정 SBGrid 짤림 -->
    <script src="../js/menu/modernizr.js"></script> <!-- Modernizr -->

    <script src="../js/menu/jquery-2.1.1.js"></script>
    <script src="../js/menu/velocity.min.js"></script>
    <script src="../js/menu/main.js"></script> <!-- Resource jQuery -->
    <!-- 네비게이션 메뉴 관련 -->

    <!-- SBGrid 관련 -->
    <script>
        var SBpath = "../AGrid/js/";
    </script>

    <script src="../AGrid/js/SBGrid/SBGrid_Lib.js"></script>
    <script src="../AGrid/js/SBGrid/SBGrid_min.js"></script>
    <link rel="stylesheet" href="../AGrid/js/SBGrid/css/SBGrid.css">
    <link rel="stylesheet" href="../AGrid/js/SBGrid/css/SBGrid_Default.css">
    <link rel="stylesheet" href="../AGrid/css/basic.css">
    <link rel="stylesheet" href="../AGrid/css/common.css">
    <script src="../AGrid/data/data.js"></script>
    <script src="../AGrid/js/toggle/toggle.js"></script>
    <script src="../AGrid/js/common.js"></script>

    <style>
        .gAjaxParam>tbody>tr>th {
            background-color: rgb(198, 217, 241);
            padding: 5px 20px 5px 20px;
        }

        .gAjaxParam>tbody>tr>td {
            background-color: white;
            padding: 5px 20px 5px 20px;
        }

        .body {
            height: 100%;
        }
    </style>

    <script type="text/javascript">
        var datagrid;
        var SBGridProperties_WB_WordList = {};
        var SBGridProperties_WSB_WordList = {};
        var newData = [];

        var gridData = []; // 그리드를 그리기 위한 데이터를 담기위한 객체를 선언합니다.
        var removeData = []; // 그리드를 그리기 위한 데이터를 담기위한 객체를 선언합니다.

        function createGrid() {
            // // 그리드의 여러 속성들을 입력합니다.
            SBGridProperties_WB_WordList.extendlastcol = 'scroll';
            SBGridProperties_WB_WordList.tooltip = true;
            SBGridProperties_WB_WordList.ellipsis = true;
            //SBGridProperties_WB_WordList.backcoloralternate = '#FFF2FF';
            SBGridProperties_WB_WordList.emptyrecords = "데이터가 존재하지 않습니다.";	//empty 문구 설정
            SBGridProperties_WB_WordList.showtotalrows = true;											//그리드 하단 전체 행 표시

            SBGridProperties_WB_WordList.rowheader = 'seq';
            SBGridProperties_WB_WordList.scrollbubbling = true;
            SBGridProperties_WB_WordList.explorerbar = 'sort';
            SBGridProperties_WB_WordList.selectmode = 'free';
            SBGridProperties_WB_WordList.filtering = false;

            SBGridProperties_WB_WordList.parentid = 'SBGridArea_WB_WordList';
            SBGridProperties_WB_WordList.id = 'datagrid';
            SBGridProperties_WB_WordList.jsonref = 'gridData';

            SBGridProperties_WB_WordList.columns = [
                { caption: ['단어장명'], ref: 'WB_NAME', width: '150px', style: 'text-align:center', type: 'output' },
                { caption: ['단어명'], ref: 'WORD_WORD', width: '150px', style: 'text-align:center', type: 'output' },
                { caption: ['단어뜻'], ref: 'WORD_MEAN', width: '150px', style: 'text-align:center', type: 'output' },
                { caption: ['예문'], ref: 'WORD_EXAM', width: '120px', style: 'text-align:center', type: 'output' },
                { caption: ['예문뜻'], ref: 'WORD_EXAM_MEAN', width: '450px', style: 'text-align:center', type: 'output' }
            ];


            SBGridProperties_WSB_WordList.extendlastcol = 'scroll';
            SBGridProperties_WSB_WordList.tooltip = true;
            SBGridProperties_WSB_WordList.ellipsis = true;
            //SBGridProperties_WSB_WordList.backcoloralternate = '#FFF2FF';
            SBGridProperties_WSB_WordList.emptyrecords = "데이터가 존재하지 않습니다.";	//empty 문구 설정
            SBGridProperties_WSB_WordList.showtotalrows = true;											//그리드 하단 전체 행 표시

            SBGridProperties_WSB_WordList.rowheader = 'seq';
            SBGridProperties_WSB_WordList.scrollbubbling = true;
            SBGridProperties_WSB_WordList.explorerbar = 'sort';
            SBGridProperties_WSB_WordList.selectmode = 'free';
            SBGridProperties_WSB_WordList.filtering = false;

            SBGridProperties_WSB_WordList.parentid = 'SBGridArea_WSB_WordList';
            SBGridProperties_WSB_WordList.id = 'datagrid2';
            SBGridProperties_WSB_WordList.jsonref = 'newData';

            SBGridProperties_WSB_WordList.columns = [
                { caption: ['단어명'], ref: 'WORD_WORD', width: '150px', style: 'text-align:center', type: 'output' },
                { caption: ['단어뜻'], ref: 'WORD_MEAN', width: '150px', style: 'text-align:center', type: 'output' },
                { caption: ['예문'], ref: 'WORD_EXAM', width: '120px', style: 'text-align:center', type: 'output' },
                { caption: ['예문뜻'], ref: 'WORD_EXAM_MEAN', width: '450px', style: 'text-align:center', type: 'output' }
            ];

            datagrid = _SBGrid.create(SBGridProperties_WB_WordList);
            datagrid.setBackColorAlternate('#cccc');
            datagrid.bind('click', 'gridClick');

            datagrid2 = _SBGrid.create(SBGridProperties_WSB_WordList);
            datagrid2.bind('click', 'RemoveGrid');
            datagrid2.setBackColorAlternate('#cccc');
        };

        var nRow = '';

        function gridClick() {

            nRow = datagrid.getRow();
            var nCol = datagrid.getCol();
            if (nRow == 0) {
                return;
            } else {
                var word = gridData[nRow - 1];
                word.UNIT_SN = '0';

                newData.push(word);
                datagrid2.refresh();
            }
        };

        function RemoveGrid() {

            var row = datagrid2.getRow();

            var emptyWord = newData[row - 1];

            if(emptyWord.MWSW_SN != null || emptyWord.MWSW_SN != '') {
                removeData.push(emptyWord);
            }

            newData.splice(row-1, 1);

            datagrid2.refresh(); //데이터 초기화
        }
    </script>
    <!-- SBGrid 관련 -->

    <style>
        .control-detail {
            padding-left: 15px !important;
        }

        .modal {
            width: 100%;
            height: 100%;
            margin: auto;
        }
    </style>

    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type='text/javascript' src='../Content/js/knockout-3.4.2.js'></script>

    <!-- UI 관련 -->

    <!-- Jquery Core Js -->
    <script src="../Content/plugins/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core Js -->
    <script src="../Content/plugins/bootstrap/js/bootstrap.js"></script>

    <!-- Select Plugin Js -->
    <!--<script src="../../Content/plugins/bootstrap-select/js/bootstrap-select.js"></script>-->

    <!-- Slimscroll Plugin Js -->
    <script src="../Content/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>

    <!-- Waves Effect Plugin Js -->
    <script src="../Content/plugins/node-waves/waves.js"></script>

    <!-- Autosize Plugin Js -->
    <script src="../Content/plugins/autosize/autosize.js"></script>

    <!-- Moment Plugin Js -->
    <!-- <script src="../Content/plugins/momentjs/moment.js"></script> -->

    <!-- Bootstrap Material Datetime Picker Plugin Js -->
    <script src="../Content/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>

    <!-- Bootstrap Datepicker Plugin Js -->
    <script src="../Content/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

    <!-- SweetAlert Plugin Js -->
    <script src="../Content/plugins/sweetalert/sweetalert.min.js"></script>

    <!-- Dropzone Plugin Js -->
    <script src="../Content/plugins/dropzone/dropzone.js"></script>

    <!-- Custom Js -->
    <script src="../Content/js/admin.js"></script>
    <script src="../Content/js/pages/forms/basic-form-elements.js"></script>
    <script src="../Content/js/pages/ui/dialogs.js"></script>

    <!-- Demo Js -->
    <script src="../Content/js/demo.js"></script>

    <!-- UI 관련 -->

    <script src="./js/WordStudyBook.js"></script>

    <!-- 처리 관련 -->
    <script type="text/javascript">

        ko.observableArray.fn.find = function (prop, data) {
            var valueToMatch = data[prop];
            return ko.utils.arrayFirst(this(), function (item) {
                return item[prop] === valueToMatch;
            });
        };

        function ViewModel() {
            this.WSB_SN = ko.observable("");
            this.WB_NAME = ko.observable("");

            this.WORD_BOOKS = ko.observableArray([]);
            this.WB_SN = ko.observable(this.WORD_BOOKS.find("WB_SN", _WB_SN));

            this.WORD_AUD_LOCS = ko.observableArray([]);
            this.WAL_SN = ko.observable(this.WORD_AUD_LOCS.find("WAL_SN", _WAL_SN));

            // this.WORD_SN = ko.observable("");
            // this.WORD_WORD = ko.observable("");
            // this.WORD_MEAN = ko.observable("");
            // this.WORD_EXAM = ko.observable("");
            // this.WORD_EXAM_MEAN = ko.observable("");
        };

        var _WB_SN = "";
        var _WAL_SN = "";

        var vm = null;

        $(document).ready(function () {
            $('html, body').css({ 'overflow': 'hidden', 'height': '100%' });
            $('#element').on('scroll touchmove mousewheel', function (event) {
                event.preventDefault();
                event.stopPropagation();
                return false;
            });


            var htmlMain = document.getElementById('htmlMain');

            vm = new ViewModel();
            ko.applyBindings(vm);
        });


        function Create() {

            swal("저장 되었습니다!", "", "success");
            // var objectData = ko.toJS(vm);

            // var jSonData = JSON.stringify(objectData);

            var objectData = GetData();

            var jSonData = JSON.stringify(objectData);

            //var name = ViewModel.AC_NAME;
            var obj = { handle: "03", view: "WordStudyBookDETAIL", data: jSonData };

            var data = JSON.stringify(obj);

            //log("Sending Data:" + data);
            window.android.setData(data);
        }

        function GetData() {

            var record = {
                WSB_SN: $("#WSB_SN").val(),
                WSB_NAME: $("#From_DT").val() + '~' + $("#To_DT").val(),
                WAL_SN: $("#WORD_AUD").val(),
                WSB_CNT_UNIT: '',
                WSB_CNT_UNIT_WORD: '',
                WSB_FROMDT: $("#From_DT").val(),
                WSB_TODT : $("#To_DT").val(),
                
                WORD_LIST: newData,
                REMOVE_LIST: removeData
            };

            return record;
        }

        function Cancel() {
            var obj = { handle: "06", view: "WordStudyBookDETAIL", data: "WORDSTUDYBOOK" };

            var data = JSON.stringify(obj);

            window.android.setData(data);
        }

        function showData(str) {

            var jsonObj = JSON.parse(str);

            switch (jsonObj.handle) {
                case "CODES":
                    vm.WORD_BOOKS(jsonObj.value);
                    vm.WB_SN(jsonObj.value[0].WB_SN);
                    break;
                case "WORDLIST":
                    gridData = jsonObj.value.WORD_LIST;
                    datagrid.refresh(); //데이터 초기화
                    break;
                case "WordAudioLoc" :
                    vm.WORD_AUD_LOCS(jsonObj.value);
                    vm.WAL_SN(jsonObj.value[0].WAL_SN);
                    break;    
                case "DETAIL":
                     vm.WSB_SN(jsonObj.value.WSB_SN);
                     vm.WAL_SN(jsonObj.value.WAL_SN);

                     _WAL_SN = jsonObj.value.WAL_SN;

                    //  console.log("WAL_SN : " + jsonObj.value.WAL_SN);

                     //$("#WORD_AUD").val(jsonObj.value.WAL_SN);
                     

                     $("#From_DT").val(jsonObj.value.WSB_FROMDT);
                     $("#To_DT").val(jsonObj.value.WSB_TODT);
                     
                    // vm.WB_NAME(jsonObj.value.WB_NAME);
                    // vm.WB_LEVEL_CD(jsonObj.value.WB_LEVEL_CD);



                    newData = jsonObj.value.WORD_LIST;

                    datagrid2.refresh(); //데이터 초기화
                    break;
            }
        }
    </script>
    <!-- 처리 관련 -->

</head>

<body id="MainBody" class="theme-red" style="margin:0;">
    <!-- Page Loader -->
    <div class="page-loader-wrapper">
        <div class="loader">
            <div class="preloader">
                <div class="spinner-layer pl-red">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
            <p>Please wait...</p>
        </div>
    </div>

    <div style="position:relative;">

        <main id="Main">

            <div style="padding-left: 2px;padding-right: 2px;">

                <div id="Manager" class="card" style="min-height:300px;">
                    <div class="header">

                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <h2>
                                    단어학습장 상세관리
                                    <small>단어학습장 정보를 입력해 주세요.</small>
                                </h2>
                            </div>

                            <ul class="header-dropdown m-r--5">
                                <li class="dropdown">
                                    <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown"
                                        role="button" aria-haspopup="true" aria-expanded="false">
                                        <i class="material-icons">more_vert</i>
                                    </a>
                                    <ul class="dropdown-menu pull-right">
                                        <!-- <li><a type="button" data-toggle="modal" data-target="#smallModal">기간선택</a>
                                        </li> -->
                                        <li><a href="javascript:void(0);">일자 별</a></li>
                                        <li><a href="javascript:void(0);">주간 별</a></li>
                                        <li><a href="javascript:void(0);">월간 별</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                    </div>
                    <div class="body">
                        <div class="row clearfix">
                            <div class="col-sm-12">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <input id="WSB_SN" type="hidden" class="control-detail form-control"
                                        placeholder="거래처 SN" data-bind="value: WSB_SN" />

                                    <div class="input-daterange input-group" id="bs_datepicker_range_container">
                                        <div class="form-line">
                                            <input id="From_DT" style="text-align: center;" type="text" class="form-control" placeholder="Date start...">
                                        </div>
                                        <span class="input-group-addon">~ </span>
                                        <div class="form-line">
                                            <input id="To_DT" style="text-align: center;" type="text" class="form-control" placeholder="Date end...">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group" style="margin-bottom: 10px;">
                                    <div class="form-line">
                                        <select id="WORD_AUD" class="form-control control-detail show-tick" data-bind="options: WORD_AUD_LOCS,
                                                                                       optionsValue: 'WAL_SN',
                                                                                       value: WAL_SN,
                                                                                       optionsText: 'WAL_NAME',
                                                                                       valueAllowUnset: true"></select>
                                    </div>
                                </div>

                                <div class="form-group" style="margin-top:0px;margin-bottom: 10px;">

                                    <div class="form-line" style="margin-bottom: 10px;">
                                        <select id="WORD_BOOK" class="form-control control-detail show-tick" data-bind="options: WORD_BOOKS,
                                                                                       optionsValue: 'WB_SN',
                                                                                       value: WB_SN,
                                                                                       optionsText: 'WB_NAME',
                                                                                       valueAllowUnset: true"></select>
                                    </div>

                                    <div id="SBGridArea_WB_WordList" style="width:100%;height: 140px;"></div>

                                    </br>

                                    <div id="SBGridArea_WSB_WordList" style="width:100%;height: 140px;"></div>
                                </div>

                                <div class="form-group" style="margin-bottom: 10px;">
                                    <table style="width:100%;">
                                        <tr>
                                            <td style="width:48%;">
                                                <button type="button" class="btn btn-primary waves-effect"
                                                    style="width:95%;margin-right:10px;" onclick="Create();">저장</button>
                                            </td>

                                            <td style="width:48%;">
                                                <button type="button" class="btn btn-primary waves-effect"
                                                    style="width:95%;margin-left:10px" onclick="Cancel()">취소</button>
                                            </td>
                                        </tr>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </main>

    </div>
</body>

</html>