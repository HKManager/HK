<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1;text/html; charset=utf-8;" />

		<script>
			var SBpath = "../../../js/";
		</script>
		<script src="../../../js/SBGrid/SBGrid_Lib.js" type="text/javascript"></script>
		<script src="../../../js/SBGrid/SBGrid_min.js" type="text/javascript"></script>
		<link href="../../../js/SBGrid/css/SBGrid.css" rel="stylesheet" type="text/css">
		<link href="../../../js/SBGrid/css/SBGrid_Default.css" rel="stylesheet" type="text/css">
		<link href="../../../css/basic.css" rel="stylesheet" type="text/css">
		<link href="../../../css/common.css" rel="stylesheet" type="text/css">
		<script src="../../../data/data.js" type="text/javascript"></script>
		<script src="../../../js/toggle/toggle.js" type="text/javascript"></script>
		<script src="../../../js/common.js" type="text/javascript"></script>
		
		<style>
            .gAjaxParam>tbody>tr>th{
                background-color:rgb(198,217,241);
                padding:5px 20px 5px 20px;
            }
            .gAjaxParam>tbody>tr>td{
                background-color:white;
                padding:5px 20px 5px 20px;
            }
        </style>
		
		<title>gridajax 방식</title>
	</head>

	<body>
		<div class="subTitle">
			<h2 class="title">gridajax를 통한 paging 방식</h2>
		</div>
		
		<p class="ctext4">Description</p>
		<ul class="descList">
			<li> ● <span style="font-weight:bold;">DB Paging 을 사용하기 위해서는 paging 속성을 필수로 사용하셔야합니다.(step 1 페이징 설정 참조)</span></li>
			<li> ● SBGrid에서 제공하는 ajax 통신을 통해 paging 하는 방식 입니다.</li>
			<li> ● <span style="color:red;font-weight:bold;">붉은 글씨체</span>는 필수 속성이며, 사용방법은 다음과 같습니다.
		</ul>
		<p class="ctext4">Example</p>
        <div class="example_box">
<pre>
    <span class="comment"></span>
    SBGridProperties.gridajax = {
        <span style="color:red;font-weight:bold;">type : "paging",</span>
        <span style="color:red;font-weight:bold;">url : "./getTestDataPage.do",</span>
        <span style="color:red;font-weight:bold;">httptype : "POST",</span>
        data : param,
        callback : fnPageCallback
    };
    
    function fnPagingCallback(status, msg) {
	if(status == "success") {
		//처리 로직
	} else if(status == "error") {
		//처리 로직
		console.log(msg);
	}
    }

</pre><br>
		<ul style="padding-left:5px;">			
			<li> &nbsp;&nbsp;<span style="font-weight:bold;">1) type</span> <span style="color:red;font-weight:bold;">[필수]</span><span style="font-weight:bold;">[string]</span></li>
			<li> &emsp;&emsp;&nbsp;- 페이징 설정을 위해 type을 <span style="color:red;font-weight:bold;">"page"</span> 로 설정이 필요합니다. </li>
			
			<li> &nbsp;&nbsp;<span style="font-weight:bold;">2) url</span> <span style="color:red;font-weight:bold;">[필수]</span><span style="font-weight:bold;">[string]</span></li>
			<li> &emsp;&emsp;&nbsp;- controller 단 URL 매핑 주소를 설정</li>
			
			<li> &nbsp;&nbsp;<span style="font-weight:bold;">3) httptype</span> <span style="color:red;font-weight:bold;">[필수]</span><span style="font-weight:bold;">[string]</span></li>
			<li> &emsp;&emsp;&nbsp;- 전송되는 데이터를 get 방식과 post 방식으로 설정 하실 수 있습니다.</li>
			
			<li> &nbsp;&nbsp;<span style="font-weight:bold;">4) data</span> <span style="color:blue;font-weight:bold;">[선택]</span><span style="font-weight:bold;">[string or object]</span></li>
			<li> &emsp;&emsp;&nbsp;- 페이징 사용시 서버에 조회조건 같은 추가로 필요한 파라미터를 전송할 때 사용합니다.</li>
			
			<li> &nbsp;&nbsp;<span style="font-weight:bold;">5) callback</span> <span style="color:blue;font-weight:bold;">[선택]</span><span style="font-weight:bold;">[string]</span></li>
			<li> &emsp;&emsp;&nbsp;- 조회결과를 전송받은 후, 처리할 로직이 필요할 경우 실행하기 위한 사용자 함수 정의</li>
		</ul>
		<p class="ctext4">request(gridajax 사용시 controller)</p>
	    <div class="example_box">
			<pre>

	//페이징 조회결과
	public void selectDBPagingList(HttpServletRequest request, HttpServletResponse response, ModelAndView model) throws Exception {
		
		Map<String, String> paramMap = new HashMap<String, String>();

		//paging 사용 시 firstIndexSB 와 limitCountSB를 토대로 시작이 되는 인덱스와, 시작인덱스부터 가져오려는 Data의 갯수를 offset과 limit에 설정해야 합니다.
		<span style="color:red;font-weight:bold;">paramMap.put("offset", request.getParameter("firstIndexSB"));		//'firstIndexSB' 파라메터명은 필수로 DB페이징 적용 시 시작이 되는 Data 인덱스</span>
		<span style="color:red;font-weight:bold;">paramMap.put("limit", request.getParameter("limitCountSB"));		//'limitCountSB' 파라메터명은 필수로 DB페이징 적용 시 시작 인덱스부터 가져오려는 Data의 갯수</span>

		<span style="color:red;font-weight:bold;">String sortBy = request.getParameter("sortSB");    //'sortSB' 파라메터는 필수는 아니지만, 사용할 경우 'sortSB' 라는 파라메터명은 준수해야 하며, sorttype : "all" 을 사용하는 경우에 그리드의 정렬 상태를 설정</span>
		if(sortBy == null || "".equals(sortBy)) {
			sortBy = "";
		}
		paramMap.put("sort_by", sortBy);
		
		try {
			Gson gson = new Gson();
			
			//데이터 조회
			List&lt;Map&lt;String, String&gt;&gt; resultList = sbGridDBPagingService.selectDBPagingList(paramMap);

			response.setCharacterEncoding("UTF-8");
			response.setContentType("text/html; charset=UTF-8");
			
			//클라이언트로 JsonData 전송
			response.getWriter().print(gson.toJson(resultList));
		
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

				</pre>
        </div>
		<p class="ctext4">response</p>
	    <div class="example_box">
			<pre>
	
	다음과 같은 조회결과 JSON에 'totalCountSB' 라는 키 값이 포함되어 있어야 정상적인 페이징결과를 확인할 수 있습니다. 
	[
		{"NO":1, "USE_YN":"Y", <span style="color:red;font-weight:bold;">"totalCountSB":114</span>, "USER_ID":"SAMPLE-00001"},
		{"NO":2, "USE_YN":"Y", <span style="color:red;font-weight:bold;">"totalCountSB":114</span>, "USER_ID":"SAMPLE-00002"},
		{"NO":3, "USE_YN":"Y", <span style="color:red;font-weight:bold;">"totalCountSB":114</span>, "USER_ID":"SAMPLE-00003"}, ...
	
	]
			</pre>
        </div>
		<br />
		<br />
	</body>
</html>